<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asset Report - {{lots.length}} Lots ({{grouping_mode}})</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      @media print {
        body {
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        .page-break {
          page-break-after: always;
        }
      }
      body {
        font-family: "Roboto", sans-serif;
        background-color: #f7fafc;
      }
      .brand-rose {
        color: #e11d48;
      }
      .bg-brand-rose {
        background-color: #e11d48;
      }
      .section-title {
        border-left: 4px solid #e11d48;
        padding-left: 12px;
        margin-bottom: 16px;
        font-weight: 600;
        color: #be123c;
      }
      .card {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.06);
        padding: 20px;
        margin-bottom: 20px;
      }
      .detail-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
      }
      .detail-item strong {
        color: #374151;
      }
      /* Enhancements */
      .badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 12px;
        font-weight: 600;
        border: 1px solid #fecdd3; /* rose-200 */
        color: #be123c; /* rose-700 */
        background: #ffe4e6; /* rose-100 */
      }
      .stat-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 18px rgba(225, 29, 72, 0.08);
        border: 1px solid #fee2e2; /* light rose ring */
        padding: 16px;
      }
      .lot-card {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.06);
        border: 1px solid #f3f4f6;
        padding: 16px;
        break-inside: avoid;
        page-break-inside: avoid;
      }
      .img-tile img {
        width: 100%;
        height: 160px;
        object-fit: contain;
        border-radius: 10px;
        border: 1px solid #fee2e2; /* rose-200 */
        break-inside: avoid;
        page-break-inside: avoid;
      }
      /* Watermark */
      .watermark { position: fixed; inset: 0; z-index: 50; pointer-events: none; display: flex; align-items: center; justify-content: center; }
      .watermark-text { font-size: clamp(48px, 12vw, 160px); font-weight: 800; letter-spacing: 0.2em; text-transform: uppercase; transform: rotate(-30deg); color: rgba(0,0,0,0.06); -webkit-text-stroke: 1px rgba(0,0,0,0.08); }
      @media print { .watermark { position: fixed !important; } }
    </style>
  </head>
  <body class="bg-slate-50">
    <div class="watermark">
      <div class="watermark-text">Confidential</div>
    </div>
    <!-- Cover Page -->
    <section id="cover-page" class="w-full h-screen flex items-center justify-center bg-white">
      <div class="max-w-3xl w-full text-center p-10">
        <img src="{{logo_url}}" alt="Company Logo" class="mx-auto mb-6" width="180" height="64" style="width:180px;height:64px;object-fit:contain;" />
        <h1 class="text-5xl font-bold brand-rose mb-2">Asset Report</h1>
        <p class="text-xl text-gray-700 mb-8">{{lots.length}} Lots ({{grouping_mode}})</p>
        <div class="mx-auto max-w-2xl text-left">
          <div class="rounded-2xl border border-gray-300 shadow-md bg-white overflow-hidden">
            <div class="flex">
              <div class="w-1.5 bg-brand-rose"></div>
              <div class="flex-1 grid grid-cols-1 sm:grid-cols-2">
                <div class="p-5 sm:p-6">
                  <div class="text-xs uppercase tracking-wider text-gray-500">Prepared for</div>
                  <div class="mt-1 text-2xl font-semibold text-gray-900">{{#if client_name}}{{client_name}}{{else}}{{inspector_name}}{{/if}}</div>
                </div>
                <div class="p-5 sm:p-6 border-t sm:border-t-0 sm:border-l border-gray-300">
                  <div class="text-xs uppercase tracking-wider text-gray-500">Report Date</div>
                  <div class="mt-1 text-2xl font-semibold text-gray-900">{{formatDate createdAt}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="page-break"></div>

    <div class="max-w-5xl mx-auto p-4 sm:p-8">
      <!-- Transmittal Letter -->
      <section class="card">
        <h2 class="text-3xl font-semibold section-title">Transmittal Letter</h2>
        <div class="text-sm text-gray-600 mb-3">
          <strong class="text-gray-800">Reference:</strong>
          {{#if appraisal_purpose}}{{appraisal_purpose}}{{else}}Asset Appraisal Report{{/if}}
        </div>
        <div class="space-y-3 text-gray-700 leading-relaxed">
          <p>
            Dear {{#if client_name}}{{client_name}}{{else}}Client{{/if}},
          </p>
          <p>
            At the request of {{#if client_name}}{{client_name}}{{else}}the Client{{/if}}, we have
            prepared an appraisal of certain assets owned by {{#if owner_name}}{{owner_name}}{{else}}the Owner{{/if}}, a copy of which is enclosed.
            This appraisal report is intended for exclusive use by {{#if client_name}}{{client_name}}{{else}}the Client{{/if}} and is intended only for
            establishing values of the listed assets.
          </p>
          <p>
            The subject assets were appraised under a premise of value appropriate for internal consideration. The cost and market approaches
            to value have been considered for this appraisal and have either been utilized where necessary or deemed inappropriate for the
            value conclusions found therein.
          </p>
          <p>
            After a thorough analysis of the assets and information made available to us, it is our opinion that as of the Effective Date
            ({{#if effective_date}}{{formatDate effective_date}}{{else}}{{formatDate createdAt}}{{/if}}), these assets have a Fair Market Value in US Funds
            as shown on the certificate that we have prepared.
          </p>
          <p>
            We certify that neither we nor any of our employees have any present or future interest in the appraised property. The fee charged for
            this appraisal was not contingent on the values reported. As such, the results stated in this letter of transmittal cannot be fully understood
            without the accompanying report and this letter should not be separated from the report.
          </p>
          <p>
            If you require any additional information, please feel free to contact me at your convenience.
          </p>
          <div class="pt-2">
            <p class="font-semibold text-gray-900">
              {{#if appraiser}}{{appraiser}}{{else}}Appraiser{{/if}}, CPPA
            </p>
            <p class="text-gray-700">Certified Appraiser</p>
            {{#if appraisal_company}}<p class="text-gray-700">{{appraisal_company}}</p>{{/if}}
          </div>
        </div>
      </section>

      <!-- Certificate of Appraisal -->
      <section class="card">
        <h2 class="text-3xl font-semibold section-title">Certificate of Appraisal</h2>
        <div class="space-y-3 text-gray-700 leading-relaxed">
          <p>
            I hereby certify that I have personally inspected the assets described herein, and have made a thorough analysis of all factors
            pertinent to their value, in accordance with the requirements of the Uniform Standards of Professional Appraisal Practice.
          </p>
          <p>
            I further certify that I have no interest, present or contemplated, in the property appraised, and that neither the employment to
            make this appraisal nor the compensation is contingent upon the value reported. The appraisal was made and the appraisal report
            prepared in conformity with the Uniform Standards of Professional Appraisal Practice.
          </p>
          <p>
            The statements of fact contained in this report are true and correct. The reported analyses, opinions, and conclusions are limited
            only by the reported assumptions and limiting conditions and are my personal, impartial, and unbiased professional analyses, opinions,
            and conclusions. No one provided significant professional assistance to the person signing this certification. I have complied with the
            requirements of the Code of Professional Ethics and the Uniform Standards of Professional Appraisal Practice.
          </p>
          <p>
            After a thorough analysis of the assets and information made available to us, it is our opinion that as of the Effective Date
            ({{#if effective_date}}{{formatDate effective_date}}{{else}}{{formatDate createdAt}}{{/if}}), these assets have a Fair Market Value in US Funds as shown below.
          </p>
          <div class="mt-3 rounded-lg border border-rose-200 bg-rose-50 p-4 text-center">
            <div class="text-xs uppercase tracking-wide text-rose-700">Total Appraised Value</div>
            {{#if total_appraised_value}}
              <div class="mt-1 text-2xl font-bold text-rose-800">{{total_appraised_value}}</div>
            {{else}}
              {{#if total_value}}
                <div class="mt-1 text-2xl font-bold text-rose-800">{{total_value}}</div>
              {{else}}
                {{#if analysis.total_value}}
                  <div class="mt-1 text-2xl font-bold text-rose-800">{{analysis.total_value}}</div>
                {{else}}
                  <div class="mt-1 text-sm text-rose-700">See Report Details and lot estimates for values.</div>
                {{/if}}
              {{/if}}
            {{/if}}
          </div>
        </div>
      </section>

      <section class="card">
        <h2 class="text-3xl font-semibold section-title">Report Summary</h2>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="stat-card">
            <div class="text-sm text-gray-500">Grouping Mode</div>
            <div class="mt-1 text-xl font-semibold text-gray-900 capitalize">
              {{grouping_mode}}
            </div>
          </div>
          <div class="stat-card">
            <div class="text-sm text-gray-500">Total Lots</div>
            <div class="mt-1 text-xl font-semibold text-gray-900">
              {{lots.length}}
            </div>
          </div>
          <div class="stat-card">
            <div class="text-sm text-gray-500">Total Images</div>
            <div class="mt-1 text-xl font-semibold text-gray-900">
              {{imageUrls.length}}
            </div>
          </div>
        </div>
        {{#if analysis.summary}}
        <div class="mt-4 stat-card">
          <h3 class="font-semibold brand-rose mb-1">AI Summary</h3>
          <p class="text-gray-700">{{analysis.summary}}</p>
        </div>
        {{/if}}
      </section>

      <!-- Report Details: Newly added metadata fields -->
      <section class="card">
        <h2 class="text-2xl font-semibold section-title">Report Details</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          {{#if client_name}}
          <div class="detail-item"><strong>Client Name</strong><span>{{client_name}}</span></div>
          {{/if}}
          {{#if effective_date}}
          <div class="detail-item"><strong>Effective Date</strong><span>{{formatDate effective_date}}</span></div>
          {{/if}}
          {{#if appraisal_purpose}}
          <div class="detail-item"><strong>Appraisal Purpose</strong><span>{{appraisal_purpose}}</span></div>
          {{/if}}
          {{#if owner_name}}
          <div class="detail-item"><strong>Owner Name</strong><span>{{owner_name}}</span></div>
          {{/if}}
          {{#if appraiser}}
          <div class="detail-item"><strong>Appraiser</strong><span>{{appraiser}}</span></div>
          {{/if}}
          {{#if appraisal_company}}
          <div class="detail-item"><strong>Appraisal Company</strong><span>{{appraisal_company}}</span></div>
          {{/if}}
          {{#if industry}}
          <div class="detail-item"><strong>Industry</strong><span>{{industry}}</span></div>
          {{/if}}
          {{#if inspection_date}}
          <div class="detail-item"><strong>Inspection Date</strong><span>{{formatDate inspection_date}}</span></div>
          {{/if}}
        </div>
      </section>

      <section class="card">
        <h2 class="text-2xl font-semibold section-title">Lots</h2>
        <div class="space-y-6">
          {{#each lots}}
          <div class="lot-card">
            <div class="flex items-center justify-between gap-3 flex-wrap">
              <h3 class="text-xl font-bold brand-rose">
                <span class="text-sm text-gray-500 font-medium"
                  >Lot {{lot_id}}</span
                >
                <span class="mx-2">â€”</span>{{title}}
              </h3>
              <div class="flex items-center gap-2">
                {{#if condition}}
                <span class="badge">{{condition}}</span>
                {{/if}} {{#if estimated_value}}
                <span class="badge">Est. Value: {{estimated_value}}</span>
                {{/if}}
              </div>
            </div>
            <p class="text-gray-700 mt-2 whitespace-pre-line">
              {{description}}
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
              {{#if image_urls}} {{#each image_urls}}
              <div class="img-tile">
                <img src="{{this}}" alt="Lot Image {{@index}}" width="220" height="160" style="width:220px;height:160px;object-fit:contain;border-radius:10px;border:1px solid #fee2e2;" />
              </div>
              {{/each}} {{else}} {{#each image_indexes}}
              <div class="img-tile">
                <img src="{{lookup @root.imageUrls this}}" alt="Lot Image {{this}}" width="220" height="160" style="width:220px;height:160px;object-fit:contain;border-radius:10px;border:1px solid #fee2e2;" />
              </div>
              {{/each}} {{/if}}
            </div>
            <div class="mt-3 text-sm text-gray-600">
              <div class="text-xs mb-2">
                <span class="badge">
                  Photos: {{#if
                  image_urls}}{{image_urls.length}}{{else}}{{image_indexes.length}}{{/if}}
                </span>
              </div>
              {{#if tags}}
              <div class="mt-1">
                <strong>Tags:</strong> {{#each tags}}<span
                  class="inline-block bg-rose-100 text-rose-700 px-2 py-0.5 rounded mr-1"
                  >{{this}}</span
                >{{/each}}
              </div>
              {{/if}}
            </div>
          </div>
          {{/each}}
        </div>
      </section>
    </div>
  </body>
</html>
